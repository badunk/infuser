(function(e){var t={};e.trafficCop=function(a,n){var r,l=a;if(2===arguments.length&&(l=e.extend(!0,n,{url:a})),r=JSON.stringify(l),r in t)for(var o in{success:1,error:1,complete:1})t[r][o](l[o]);else t[r]=e.ajax(l).always(function(){delete t[r]});return t[r]},"function"==typeof define&&define.amd&&define(function(){return e.trafficCop})})(jQuery),function(){var e=function(e,t){var a={templates:{},storeTemplate:function(e,t){this.templates[e]=t},getTemplate:function(e){return this.templates[e]},purge:function(){this.templates={}}},n={templateIds:[],storeTemplate:function(e,t){var a=document.getElementById(e);null===a&&(this.templateIds.push(e),a=document.createElement("script"),a.type="text/html",a.id=e,document.body.appendChild(a)),a.text=t},getTemplate:function(e){return document.getElementById(e)},purge:function(){for(var e=0;this.templateIds.length>e;e++)document.body.removeChild(document.getElementById(this.templateIds[e]));this.templateIds=[]}},r="<div class='infuser-error'>The template <a href='{TEMPLATEURL}'>{TEMPLATEID}</a> could not be loaded. {STATUS}</div>",l=function(e,t,a){return r.replace("{STATUS}",e).replace("{TEMPLATEID}",t).replace("{TEMPLATEURL}",a)},o=[],u={getTemplatePath:function(e){var t=e.templatePrefix+e.templateId+e.templateSuffix;return void 0===e.templateUrl||""===e.templateUrl?t:e.templateUrl+"/"+t},templateGetSuccess:function(e,t){return function(a){var n=i.defaults.templatePreProcessor(a);i.store.storeTemplate(e,n),t(i.store.getTemplate(e))}},templateGetError:function(t,a,n){return function(r){-1===e.inArray(t,o)&&o.push(t);var u=l("HTTP Status code: "+r.status,t,a);i.store.storeTemplate(t,u),n(i.store.getTemplate(t))}},getAjaxOptions:function(){}},i={storageOptions:{hash:a,script:n},store:a,defaults:{templateUrl:"",templateSuffix:".html",templatePrefix:"",templatePreProcessor:function(e){return e},ajax:{async:!0,dataType:"html",type:"GET"},target:function(e){return"#"+e},loadingTemplate:{content:'<div class="infuser-loading">Loading...</div>',transitionIn:function(t,a){var n=e(t);n.hide(),n.html(a),n.fadeIn()},transitionOut:function(t){e(t).html("")}},postRender:function(){},preRender:function(){},render:function(t,a){var n=e(t);0===n.children().length?n.append(e(a)):n.children().replaceWith(e(a))},bindingInstruction:function(e){return e},useLoadingTemplate:!0},get:function(a,n){var r,l=e.extend({},i.defaults,"object"==typeof a?a:{templateId:a});l.ajax.url=u.getTemplatePath(l),r=i.store.getTemplate(l.ajax.url),r&&-1===e.inArray(l.ajax.url,o)?n(r):(l.ajax.success=u.templateGetSuccess(l.ajax.url,n),l.ajax.error=u.templateGetError(l.templateId,l.ajax.url,n),t(l.ajax))},getSync:function(t){var a,n,r=e.extend({},i.defaults,"object"==typeof t?t:{templateId:t},{ajax:{async:!1}});return r.ajax.url=u.getTemplatePath(r),a=i.store.getTemplate(r.ajax.url),a&&-1===e.inArray(r.ajax.url,o)||(n=null,r.ajax.success=function(e){n=e},r.ajax.error=function(){-1===e.inArray(r.ajax.url)&&o.push(r.ajax.url),n=l("HTTP Status code: exception.status",r.templateId,r.ajax.url)},e.ajax(r.ajax),null===n?n=l("An unknown error occurred.",r.templateId,r.ajax.url):(i.store.storeTemplate(r.ajax.url,n),a=i.store.getTemplate(r.ajax.url))),a},infuse:function(t,a){var n=e.extend({},i.defaults,"object"==typeof t?t:a,"string"==typeof t?{templateId:t}:void 0),r="function"==typeof n.target?n.target(t):n.target;n.useLoadingTemplate&&n.loadingTemplate.transitionIn(r,n.loadingTemplate.content),i.get(n,function(e){var t=e;n.preRender(r,t),t=n.bindingInstruction(t,n.model),n.useLoadingTemplate&&n.loadingTemplate.transitionOut(r),n.render(r,t),n.postRender(r)})}};return i};if("function"==typeof define&&define.amd)define(["jquery","trafficCop"],function(t,a){return e(t,a)});else{var t=(!1||eval)("this");t.infuser=e($||jQuery)}}();