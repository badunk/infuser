/*!
    infuser.js
    Author: Jim Cowart
    License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
    Version 0.2.0
*/
var hashStorage={templates:{},storeTemplate:function(e,t){this.templates[e]=t},getTemplate:function(e){return this.templates[e]},purge:function(){this.templates={}}},errorHtml="<div class='infuser-error'>The template <a href='{TEMPLATEURL}'>{TEMPLATEID}</a> could not be loaded. {STATUS}</div>",returnErrorTemplate=function(e,t,r){return errorHtml.replace("{STATUS}",e).replace("{TEMPLATEID}",t).replace("{TEMPLATEURL}",r)},errors=[],helpers={getTemplatePath:function(e){var t=e.templatePrefix+e.templateId+e.templateSuffix;return void 0===e.templateUrl||""===e.templateUrl?t:e.templateUrl+"/"+t},templateGetSuccess:function(e,t){return function(r){var a=infuser.defaults.templatePreProcessor(r);infuser.store.storeTemplate(e,a),t(infuser.store.getTemplate(e))}},templateGetError:function(e,t,r){return function(a){-1===$.inArray(e,errors)&&errors.push(e);var n=returnErrorTemplate("HTTP Status code: "+a.status,e,t);infuser.store.storeTemplate(e,n),r(infuser.store.getTemplate(e))}},getAjaxOptions:function(){}},infuserOptions=["target","loadingTemplate","postRender","preRender","render","bindingInstruction","useLoadingTemplate","model","templateUrl","templateSuffix","templatePrefix",""],infuser={storageOptions:{hash:hashStorage,script:scriptStorage},store:hashStorage,defaults:{templateUrl:"",templateSuffix:".html",templatePrefix:"",templatePreProcessor:function(e){return e},ajax:{async:!0,dataType:"html",type:"GET"},target:function(e){return"#"+e},loadingTemplate:{content:'<div class="infuser-loading">Loading...</div>',transitionIn:function(e,t){var r=$(e);r.hide(),r.html(t),r.fadeIn()},transitionOut:function(e){$(e).html("")}},postRender:function(){},preRender:function(){},render:function(e,t){var r=$(e);0===r.children().length?r.append($(t)):r.children().replaceWith($(t))},bindingInstruction:function(e){return e},useLoadingTemplate:!0},get:function(e,t){var r,a=$.extend({},infuser.defaults,"object"==typeof e?e:{templateId:e});a.ajax.url=helpers.getTemplatePath(a),r=infuser.store.getTemplate(a.ajax.url),r&&-1===$.inArray(a.ajax.url,errors)?t(r):(a.ajax.success=helpers.templateGetSuccess(a.ajax.url,t),a.ajax.error=helpers.templateGetError(a.templateId,a.ajax.url,t),$.trafficCop(a.ajax))},getSync:function(e){var t,r,a=$.extend({},infuser.defaults,"object"==typeof e?e:{templateId:e},{ajax:{async:!1}});return a.ajax.url=helpers.getTemplatePath(a),t=infuser.store.getTemplate(a.ajax.url),t&&-1===$.inArray(a.ajax.url,errors)||(r=null,a.ajax.success=function(e){r=e},a.ajax.error=function(){-1===$.inArray(a.ajax.url)&&errors.push(a.ajax.url),r=returnErrorTemplate("HTTP Status code: exception.status",a.templateId,a.ajax.url)},$.ajax(a.ajax),null===r?r=returnErrorTemplate("An unknown error occurred.",a.templateId,a.ajax.url):(infuser.store.storeTemplate(a.ajax.url,r),t=infuser.store.getTemplate(a.ajax.url))),t},infuse:function(e,t){var r=$.extend({},infuser.defaults,"object"==typeof e?e:t,"string"==typeof e?{templateId:e}:void 0),a="function"==typeof r.target?r.target(e):r.target;r.useLoadingTemplate&&r.loadingTemplate.transitionIn(a,r.loadingTemplate.content),infuser.get(r,function(e){var t=e;r.preRender(a,t),t=r.bindingInstruction(t,r.model),r.useLoadingTemplate&&r.loadingTemplate.transitionOut(a),r.render(a,t),r.postRender(a)})}};