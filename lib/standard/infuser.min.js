(function(a,b,c){var d={templates:{},storeTemplate:function(a,b){this.templates[a]=b},getTemplate:function(a){return this.templates[a]},purge:function(){this.templates={}}},e={templateIds:[],storeTemplate:function(a,b){var c=document.getElementById(a);c===null&&(this.templateIds.push(a),c=document.createElement("script"),c.type="text/html",c.id=a,document.body.appendChild(c)),c.text=b},getTemplate:function(a){return document.getElementById(a)},purge:function(){for(var a=0;a<this.templateIds.length;a++)document.body.removeChild(document.getElementById(this.templateIds[a]));this.templateIds=[]}},f="<div class='infuser-error'>The template <a href='{TEMPLATEURL}'>{TEMPLATEID}</a> could not be loaded. {STATUS}</div>",g=function(a,b,c){return f.replace("{STATUS}",a).replace("{TEMPLATEID}",b).replace("{TEMPLATEURL}",c)},h=[],i={getTemplatePath:function(a){var b=a.templatePrefix+a.templateId+a.templateSuffix;return a.templateUrl===c||a.templateUrl===""?b:a.templateUrl+"/"+b},templateGetSuccess:function(a,b){return function(c){j.store.storeTemplate(a,c),b(j.store.getTemplate(a))}},templateGetError:function(b,c,d){return function(e){a.inArray(b,h)===-1&&h.push(b);var f=g("HTTP Status code: "+e.status,b,c);j.store.storeTemplate(b,f),d(j.store.getTemplate(b))}}},j={storageOptions:{hash:d,script:e},store:d,defaults:{templateUrl:"",templateSuffix:".html",templatePrefix:"",async:!0,dataType:"html",type:"GET",target:function(a){return"#"+a},loadingTemplate:{content:'<div class="infuser-loading">Loading...</div>',transitionIn:function(b,c){var d=a(b);d.hide(),d.html(c),d.fadeIn()},transitionOut:function(b){a(b).html("")}},postRender:function(a){},preRender:function(a,b){},render:function(b,c){var d=a(b);d.children().length===0?d.append(a(c)):d.children().replaceWith(a(c))},bindingInstruction:function(a,b){return a},useLoadingTemplate:!0},get:function(b,c){var d=a.extend({},j.defaults,typeof b=="object"?b:{templateId:b}),e=this.store.getTemplate(d.templateId);!e||a.inArray(d.templateId,h)!==-1?(d.url=i.getTemplatePath(d),d.success=i.templateGetSuccess(d.templateId,c),d.error=i.templateGetError(d.templateId,d.url,c),a.trafficCop(d)):c(e)},getSync:function(b){var c=a.extend({},j.defaults,typeof b=="object"?b:{templateId:b},{async:!1}),d=this.store.getTemplate(c.templateId),e;if(!d||a.inArray(c.templateId,h)!==-1)c.url=i.getTemplatePath(c),e=null,c.success=function(a){e=a},c.error=function(b){a.inArray(c.templateId)===-1&&h.push(c.templateId),e=g("HTTP Status code: exception.status",c.templateId,c.url)},a.ajax(c),e===null?e=g("An unknown error occurred.",templateId,templatePath):(this.store.storeTemplate(c.templateId,e),d=this.store.getTemplate(c.templateId));return d},infuse:function(b,d){var e=a.extend({},j.defaults,typeof b=="object"?b:d,typeof b=="string"?{templateId:b}:c),f=typeof e.target=="function"?e.target(b):e.target;e.useLoadingTemplate&&e.loadingTemplate.transitionIn(f,e.loadingTemplate.content),j.get(e,function(a){var b=a;e.preRender(f,b),b=e.bindingInstruction(b,e.model),e.useLoadingTemplate&&e.loadingTemplate.transitionOut(f),e.render(f,b),e.postRender(f)})}};b.infuser=j})(jQuery,window)