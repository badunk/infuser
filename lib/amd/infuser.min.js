define(["jquery"],function(a){var b={templates:{},storeTemplate:function(a,b){this.templates[a]=b},getTemplate:function(a){return this.templates[a]},purge:function(){this.templates={}}},c={templateIds:[],storeTemplate:function(a,b){var c=document.getElementById(a);c===null&&(this.templateIds.push(a),c=document.createElement("script"),c.type="text/html",c.id=a,document.body.appendChild(c)),c.text=b},getTemplate:function(a){return document.getElementById(a)},purge:function(){for(var a=0;a<this.templateIds.length;a++)document.body.removeChild(document.getElementById(this.templateIds[a]));this.templateIds=[]}},d="<div class='infuser-error'>The template <a href='{TEMPLATEURL}'>{TEMPLATEID}</a> could not be loaded. {STATUS}</div>",e=function(a,b,c){return d.replace("{STATUS}",a).replace("{TEMPLATEID}",b).replace("{TEMPLATEURL}",c)},f=[],g={getTemplatePath:function(a){var b=a.templatePrefix+a.templateId+a.templateSuffix;return a.templateUrl===undefined||a.templateUrl===""?b:a.templateUrl+"/"+b},templateGetSuccess:function(a,b){return function(c){i.store.storeTemplate(a,c),b(i.store.getTemplate(a))}},templateGetError:function(b,c,d){return function(g){a.inArray(b,f)===-1&&f.push(b);var h=e("HTTP Status code: "+g.status,b,c);i.store.storeTemplate(b,h),d(i.store.getTemplate(b))}},getAjaxOptions:function(a){}},h=["target","loadingTemplate","postRender","preRender","render","bindingInstruction","useLoadingTemplate","model","templateUrl","templateSuffix","templatePrefix",""],i={storageOptions:{hash:b,script:c},store:b,defaults:{templateUrl:"",templateSuffix:".html",templatePrefix:"",ajax:{async:!0,dataType:"html",type:"GET"},target:function(a){return"#"+a},loadingTemplate:{content:'<div class="infuser-loading">Loading...</div>',transitionIn:function(b,c){var d=a(b);d.hide(),d.html(c),d.fadeIn()},transitionOut:function(b){a(b).html("")}},postRender:function(a){},preRender:function(a,b){},render:function(b,c){var d=a(b);d.children().length===0?d.append(a(c)):d.children().replaceWith(a(c))},bindingInstruction:function(a,b){return a},useLoadingTemplate:!0},get:function(b,c){var d=a.extend({},i.defaults,typeof b=="object"?b:{templateId:b}),e;d.ajax.url=g.getTemplatePath(d),e=i.store.getTemplate(d.ajax.url),!e||a.inArray(d.ajax.url,f)!==-1?(d.ajax.success=g.templateGetSuccess(d.ajax.url,c),d.ajax.error=g.templateGetError(d.templateId,d.ajax.url,c),a.trafficCop(d.ajax)):c(e)},getSync:function(b){var c=a.extend({},i.defaults,typeof b=="object"?b:{templateId:b},{ajax:{async:!1}}),d,h;c.ajax.url=g.getTemplatePath(c),d=i.store.getTemplate(c.ajax.url);if(!d||a.inArray(c.ajax.url,f)!==-1)h=null,c.ajax.success=function(a){h=a},c.ajax.error=function(b){a.inArray(c.ajax.url)===-1&&f.push(c.ajax.url),h=e("HTTP Status code: exception.status",c.templateId,c.ajax.url)},a.ajax(c.ajax),h===null?h=e("An unknown error occurred.",c.templateId,c.ajax.url):(i.store.storeTemplate(c.ajax.url,h),d=i.store.getTemplate(c.ajax.url));return d},infuse:function(b,c){var d=a.extend({},i.defaults,typeof b=="object"?b:c,typeof b=="string"?{templateId:b}:undefined),e=typeof d.target=="function"?d.target(b):d.target;d.useLoadingTemplate&&d.loadingTemplate.transitionIn(e,d.loadingTemplate.content),i.get(d,function(a){var b=a;d.preRender(e,b),b=d.bindingInstruction(b,d.model),d.useLoadingTemplate&&d.loadingTemplate.transitionOut(e),d.render(e,b),d.postRender(e)})}};return i})